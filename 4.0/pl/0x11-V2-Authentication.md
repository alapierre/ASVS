# V2 Autentykacja

## Wytyczne kontrolne

Uwierzytelnianie to czynność ustalania lub potwierdzania, że ktoś (lub coś) jest autentyczny i że operacje dokonane przez osobę lub dotyczące jej urządzenia są poprawne, odporne na podszywanie się i zapobiegają odzyskiwaniu lub przechwyceniu haseł.

Gdy ASVS został po raz pierwszy wydany, nazwa użytkownika + hasło było najbardziej powszechną formą uwierzytelniania poza systemami o wysokim poziomie zabezpieczeń. Wieloskładnikowe uwierzytelnianie (MFA) było powszechnie akceptowane w kręgach związanych z bezpieczeństwem, ale rzadko wymagane gdzie indziej. Wraz ze wzrostem liczby naruszeń haseł, pomysł, że nazwy użytkowników są poufne, a hasła nikomu nieznane, uczynił wiele kontroli zabezpieczeń nie do utrzymania. Na przykład, NIST 800-63 uważa nazwy użytkowników i uwierzytelnianie oparte na wiedzy (KBA) za informacje publiczne, powiadomienia SMS i e-mail jako ["restricted" authenticator types](https://pages.nist.gov/800-63-FAQ/#q-b1), a hasła za wcześniej naruszone. Ta rzeczywistość sprawia, że uwierzytelnianie oparte na wiedzy, odzyskiwanie za pomocą SMS-ów i e-maili, historia haseł, złożoność i kontrola rotacji stają się bezużyteczne. Te kontrole zawsze były mniej niż pomocne, często zmuszając użytkowników do wymyślania słabych haseł co kilka miesięcy, ale wraz z ujawnieniem ponad 5 miliardów nazw użytkowników i haseł, nadszedł czas, aby się z nimi rozstać.

Ze wszystkich rozdziałów ASVS, rozdziały dotyczące uwierzytelniania i zarządzania sesjami uległy największym zmianom. Przyjęcie skutecznych, opartych na dowodach najlepszych praktyk będzie wyzwaniem dla wielu osób, i to jest absolutnie w porządku. Musimy teraz rozpocząć przejście do przyszłości pozbawionej haseł.

## NIST 800-63 - Nowoczesny, oparty na dowodach standard uwierzytelniania

[NIST 800-63b](https://pages.nist.gov/800-63-3/sp800-63b.html) to nowoczesny, oparty na dowodach standard, który reprezentuje najlepsze dostępne porady, niezależnie od ich zastosowania. Standard ten jest przydatny dla wszystkich organizacji na całym świecie, ale szczególnie dotyczy agencji amerykańskich oraz tych, które współpracują z agencjami amerykańskimi.

Terminologia NIST 800-63 może być na początku nieco myląca, zwłaszcza jeśli jesteś przyzwyczajony jedynie do uwierzytelniania za pomocą nazwy użytkownika i hasła. Postępy w nowoczesnym uwierzytelnianiu są konieczne, więc musimy wprowadzić terminologię, która stanie się powszechna w przyszłości, ale rozumiemy trudności w jej zrozumieniu, dopóki branża nie zaakceptuje tych nowych terminów. Na końcu tego rozdziału dostarczyliśmy słowniczek, który może pomóc. Przeformułowaliśmy wiele wymagań, aby spełnić intencję wymagania, a nie tylko jego dosłowne brzmienie. Na przykład, ASVS używa terminu "hasło", gdy NIST używa "memorized secret" (tajemnica zapamiętana) w całym tym standardzie.

ASVS V2 Uwierzytelnianie, V3 Zarządzanie sesjami i w mniejszym stopniu, V4 Kontrola dostępu zostały dostosowane, aby być zgodnym podzbiorem wybranych kontroli NIST 800-63b, skoncentrowanym wokół powszechnych zagrożeń i powszechnie wykorzystywanych słabości uwierzytelniania. Tam, gdzie wymagana jest pełna zgodność z NIST 800-63, proszę skonsultować się z NIST 800-63.

### Wybór odpowiedniego poziomu AAL

Standard weryfikacji bezpieczeństwa aplikacji (Application Security Verification Standard - ASVS) stara się zmapować `ASVS L1` na wymagania `NIST AAL1`, `L2` na `AAL2` i `L3` na `AAL3`. Jednak podejście ASVS `Level 1` jako "niezbędne" kontrole, niekoniecznie musi być właściwym poziomem AAL do weryfikacji aplikacji lub API. Na przykład, jeśli aplikacja jest aplikacją `Level 3` lub ma wymogi regulacyjne dotyczące `AAL3`, należy wybrać `Level 3` w rozdziałach V2 oraz V3 Zarządzanie sesjami. Wybór zgodnego z `NIST` poziomu Authentication Assertion Level (`AAL`) powinien być przeprowadzony zgodnie z wytycznymi `NIST 800-63b`, jak opisano w *Selecting AAL* w [NIST 800-63b Section 6.2](https://pages.nist.gov/800-63-3/sp800-63-3.html#AAL_CYOA).

## Legenda

Aplikacje zawsze mogą stosować wyższe wymagania poziomu bezpieczeństwa haseł, zwłaszcza jeśli nowoczesne uwierzytelnianie znajduje się w harmonogramie rozbudowy aplikacji. Wcześniej `ASVS` wymagał obowiązkowego wieloskładnikowego uwierzytelniania (MFA). `NIST` nie wymaga obowiązkowego `MFA`. Dlatego użyliśmy oznaczenia opcjonalnego w tym rozdziale, aby wskazać, gdzie `ASVS` zachęca, ale nie wymaga kontroli. W całym standardzie używane są następujące oznaczenia:

| Mark | Description                     |
|:----:|:--------------------------------|
|      | Nie wymagane                    |
|  o   | Rekomendowane, ale nie wymagane |
|  ✓   | Wymagane                        |

## V2.1 Bezpieczeństwo Haseł

Hasła, nazywane `Memorized Secrets` (zapamiętane tajemnice) przez `NIST 800-63`, obejmują hasła, kody PIN, wzory odblokowania, wybór *poprawnego kociaka* lub innego elementu obrazu oraz tzw. passphrases. Są one ogólnie uważane za *coś, co wiesz* i często używane jako jednoskładnikowe uwierzytelnianie. Istnieją znaczące wyzwania związane z kontynuowaniem stosowania uwierzytelniania jednoskładnikowego, w tym miliardy prawidłowych nazw użytkowników i haseł ujawnionych w Internecie, domyślne lub słabe hasła, tablice tęczowe i uporządkowane słowniki najczęstszych haseł.

Aplikacje powinny zdecydowanie zachęcać użytkowników do korzystania z wieloskładnikowego uwierzytelniania (`MFA`) i pozwalać im na ponowne użycie posiadanych już tokenów, takich jak tokeny `FIDO` lub `U2F`, lub łączyć się z dostawcą usług uwierzytelniania, który oferuje uwierzytelnianie wieloskładnikowe.

Dostawcy usług uwierzytelniania (Credential Service Providers - `CSP`) dostarczają zidentyfikowane tożsamości użytkowników. Użytkownicy często mają więcej niż jedną tożsamość u wielu `CSP`, takich jak tożsamość korporacyjna z wykorzystaniem Azure AD, Okta, Ping Identity lub Google, lub tożsamość konsumencką z wykorzystaniem Facebooka, Twittera, Google'a czy WeChat, aby wymienić tylko kilka popularnych alternatyw. Ta lista nie stanowi rekomendacji tych firm lub usług, ale jedynie zachętę dla deweloperów, aby rozważyli fakt, że wielu użytkowników ma wiele ustanowionych tożsamości. Organizacje powinny rozważyć integrację z istniejącymi tożsamościami użytkowników, zgodnie z profilem ryzyka związanym z siłą dowodzenia tożsamości przez CSP. Na przykład, mało prawdopodobne jest, aby organizacja rządowa akceptowała tożsamość z mediów społecznościowych jako login do wrażliwych systemów, ponieważ łatwo jest tworzyć fałszywe lub jednorazowe tożsamości, podczas gdy firma tworząca gry mobilne może potrzebować integracji z głównymi platformami mediów społecznościowych, aby zwiększyć liczbę aktywnych graczy.

|     #      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:----------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.1.1**  | Sprawdź, czy hasła ustawiane przez użytkowników mają co najmniej 12 znaków długości (po połączeniu wielokrotnych spacji). ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.2**  | Sprawdź, czy dozwolone są hasła o długości co najmniej 64 znaków, a hasła o długości większej niż 128 znaków są odrzucane. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.3**  | Sprawdź, czy nie jest wykonywane skracanie haseł. Jednak kolejne wielokrotne spacje mogą być zastąpione pojedynczą spacją. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.4**  | Sprawdź, czy dozwolone są wszystkie drukowalne znaki Unicode, w tym znaki neutralne językowo, takie jak spacje i emotikony (emoji) w hasłach.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.5**  | Sprawdź, czy użytkownicy mogą zmieniać swoje hasła.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ✓  | ✓  | ✓  | 620 |                            5.1.1.2                            |
| **2.1.6**  | Sprawdź, czy funkcja zmiany hasła wymaga podania bieżącego i nowego hasła użytkownika.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ✓  | ✓  | ✓  | 620 |                            5.1.1.2                            |
| **2.1.7**  | Sprawdź, czy hasła przesyłane podczas rejestracji konta, logowania i zmiany hasła są sprawdzane względem zbioru naruszonych haseł, lokalnie (na przykład 1 000 lub 10 000 najczęstszych haseł, które spełniają politykę haseł systemu) lub za pomocą zewnętrznego API. Korzystając z API, należy użyć dowodu o zerowej wiedzy lub innego mechanizmu, aby zapewnić, że hasło w postaci jawnej nie jest wysyłane ani używane do weryfikacji stanu naruszenia hasła. Jeśli hasło jest naruszone, aplikacja musi wymagać od użytkownika ustawienia nowego, nieznaruszonego hasła. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.8**  | Sprawdź, czy dostarczono miernik siły hasła, który pomaga użytkownikom ustawić silniejsze hasło.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.9**  | Sprawdź, czy nie ma żadnych zasad składniowych dla haseł ograniczających rodzaj dozwolonych znaków. Nie powinno być wymogów dotyczących wielkich lub małych liter, cyfr ani znaków specjalnych. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                                                                                                                                                                                                                                               | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.10** | Sprawdź, czy nie ma wymagań dotyczących okresowej rotacji poświadczeń ani historii haseł.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ✓  | ✓  | ✓  | 263 |                            5.1.1.2                            |
| **2.1.11** | Sprawdź, czy dozwolone są funkcje "wklej", menedżery haseł przeglądarki oraz zewnętrzne menedżery haseł.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |
| **2.1.12** | Sprawdź, czy użytkownik może wybrać opcję tymczasowego wyświetlania całego zamaskowanego hasła lub tymczasowego wyświetlania ostatnio wpisanego znaku hasła na platformach, które nie mają tej funkcji wbudowanej.                                                                                                                                                                                                                                                                                                                                                                                                                                    | ✓  | ✓  | ✓  | 521 |                            5.1.1.2                            |

Uwaga: Celem umożliwienia użytkownikowi wyświetlenia swojego hasła lub tymczasowego zobaczenia ostatniego znaku jest poprawa użyteczności wprowadzania poświadczeń, szczególnie w przypadku dłuższych haseł, haseł wielowyrazowych i menedżerów haseł. Kolejnym powodem uwzględnienia tego wymagania jest zniechęcenie lub zapobieganie niepotrzebnym raportom testowym wymagającym od organizacji zastąpienia wbudowanego zachowania pól haseł platformy w celu usunięcia tego nowoczesnego, przyjaznego dla użytkownika doświadczenia związane z bezpieczeństwem.

## V2.2 Ogólne zasady bezpieczeństwa uwierzytelniania

Elastyczność uwierzytelniania jest kluczowa dla zabezpieczenia aplikacji na przyszłość. Zrefaktoryzuj mechanizmy uwierzytelniające w aplikacji, aby umożliwić dodawanie dodatkowych metod uwierzytelniających zgodnie z preferencjami użytkowników, a także umożliwić im wycofywanie przestarzałych lub niebezpiecznych metod uwierzytelniających w uporządkowany sposób.

`NIST` uważa e-mail i SMS jako ["restricted" authenticator types](https://pages.nist.gov/800-63-FAQ/#q-b1) i prawdopodobnie zostaną one usunięte z NIST 800-63, a tym samym z `ASVS`, w przyszłości. Aplikacje powinny planować ścieżkę rozwoju, która nie wymaga korzystania z e-maila ani SMS.

|                                                                                                #                                                                                                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | L1 | L2 | L3  |  CWE  | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:---:|:-----:|:-------------------------------------------------------------:|
|                                                                                            **2.2.1**                                                                                            | Sprawdź, czy kontrole antyautomatyzacyjne skutecznie zapobiegają testowaniu naruszonych poświadczeń, atakom typu brute force oraz blokowaniu kont. Takie kontrole obejmują blokowanie najczęstszych naruszonych haseł, miękkie blokady, limitowanie liczby prób, CAPTCHA, coraz dłuższe opóźnienia między próbami, ograniczenia adresów IP lub restrykcje oparte na ryzyku, takie jak lokalizacja, pierwsze logowanie na urządzeniu, ostatnie próby odblokowania konta lub podobne. Sprawdź, czy na jednym koncie nie jest możliwe więcej niż 100 nieudanych prób logowania na godzinę. | ✓  | ✓  |  ✓  |  307  |              5.2.2 / 5.1.1.2 / 5.1.4.2 / 5.1.5.2              |
|                                                                                            **2.2.2**                                                                                            | Sprawdź, czy używanie słabych metod uwierzytelniających (takich jak SMS i e-mail) jest ograniczone do weryfikacji wtórnej i zatwierdzenia transakcji, a nie jako zastępstwo dla bardziej bezpiecznych metod uwierzytelniania. Sprawdź, czy silniejsze metody są oferowane przed słabymi metodami, czy użytkownicy są świadomi ryzyka lub czy stosowane są odpowiednie środki zapobiegające ryzyku naruszenia konta.                                                                                                                                                                     | ✓  | ✓  |  ✓  |  304  |                            5.2.10                             |
|                                                                                            **2.2.3**                                                                                            | Sprawdź, czy użytkownicy otrzymują bezpieczne powiadomienia po aktualizacji danych uwierzytelniających, takich jak resetowanie poświadczeń, zmiany adresu e-mail lub adresu, logowanie z nieznanych lub ryzykownych lokalizacji. Preferowane jest stosowanie powiadomień push, a nie SMS lub e-mail, ale w przypadku braku powiadomień push, SMS lub e-mail są dopuszczalne, pod warunkiem, że w powiadomieniu nie ujawnia się żadnych wrażliwych informacji.                                                                                                                           | ✓  | ✓  |  ✓  |  620  |                                                               |
|                                                                                            **2.2.4**                                                                                            | Sprawdź, czy uwierzytelnianie zapewnia odporność na podszywanie się w przypadku phishingu, na przykład poprzez użycie uwierzytelniania wieloskładnikowego, urządzeń kryptograficznych (takich jak klucze sprzętowe do uwierzytelniania), lub na wyższych poziomach AAL - certyfikatów po stronie klienta.                                                                                                                                                                                                                                                                               |    |    |  ✓  |  308  |                             5.2.5                             |
|                                                                                            **2.2.5**                                                                                            | Sprawdź, czy w przypadku, gdy usługa dostawcy poświadczeń (CSP) i aplikacja weryfikująca uwierzytelnienie są odseparowane, między dwoma punktami końcowymi stosowany jest wzajemnie uwierzytelniony protokół TLS.                                                                                                                                                                                                                                                                                                                                                                       |    |    |  ✓  |  319  |                             5.2.6                             |
|                                                                                            **2.2.6**                                                                                            | Sprawdź, czy odporność na powtórzenie jest zapewniona poprzez wymagane użycie urządzeń haseł jednorazowych (`OTP`), urządzeń kryptograficznych lub jednorazowych kodów weryfikacyjnych.                                                                                                                                                                                                                                                                                                                                                                                                 |    |    |  ✓  |  308  |                             5.2.8                             |
|                                                                                            **2.2.7**                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |    |    |     |       |                                                               |
| Sprawdź, czy w celu uwierzytelnienia użytkownika wymagane jest wprowadzenie tokenu OTP lub działanie zainicjowane przez użytkownika, takie jak naciśnięcie przycisku na sprzętowym kluczu FIDO. |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |    | ✓  | 308 | 5.2.9 |                                                               |

## V2.3 Cykl życia procesu uwierzytelniania

Uwierzytelnianie może odbywać się za pomocą haseł, tokenów sprzętowych oraz urządzeń biometrycznych. Cykl życia procesu uwierzytelniania jest kluczowy dla bezpieczeństwa aplikacji — jeśli każdy może samodzielnie zarejestrować konto bez dowodu tożsamości, trudno zaufać twierdzeniu co do tożsamości. Dla serwisów społecznościowych, takich jak Reddit, jest to w porządku. Dla systemów bankowych kluczowe jest większe skupienie na rejestracji i wydawaniu poświadczeń oraz urządzeń w celu zapewnienia bezpieczeństwa aplikacji.

Uwaga: Hasła nie powinny mieć maksymalnego okresu użytkowania ani być poddawane rotacji haseł. Hasła powinny być sprawdzane pod kątem naruszenia, a nie regularnie wymieniane.

|     #     | Description                                                                                                                                                                                                                                                                                                                      | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:---------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.3.1** | Sprawdź, czy system generuje początkowe hasła lub kody aktywacyjne, które powinny być bezpiecznie losowo generowane, powinny mieć co najmniej 6 znaków oraz mogą zawierać litery i cyfry, a także powinny wygasnąć po krótkim okresie czasu. Te początkowe tajemnice nie mogą być dopuszczone do stałego użytkowania jako hasła. | ✓  | ✓  | ✓  | 330 |                         5.1.1.2 / A.3                         |
| **2.3.2** | Sprawdź, czy jest możliwe zarejestrowanie i użycie przez użytkownika własnych urządzeń uwierzytelniających, takich jak tokeny U2F lub FIDO.                                                                                                                                                                                      |    | ✓  | ✓  | 308 |                             6.1.3                             |
| **2.3.3** | Sprawdź, czy instrukcje dotyczące odnawiania poświadczeń czasowych są wysyłane z odpowiednim wyprzedzeniem przed terminem ich wygaśnięcia.                                                                                                                                                                                       |    | ✓  | ✓  | 287 |                             6.1.4                             |

## V2.4 Przechowywanie danych autoryzacyjnych

Architekci i programiści powinni przestrzegać tej sekcji podczas tworzenia lub przerabiania kodu. Tę sekcję można w pełni zweryfikować jedynie poprzez przegląd kodu źródłowego lub za pomocą bezpiecznych testów jednostkowych, lub integracyjnych. Testy penetracyjne nie pozwalają na identyfikację żadnego z tych problemów.

Lista zatwierdzonych jednokierunkowych funkcji pochodzenia klucza (*one-way key derivation functions*) jest szczegółowo opisana w sekcji `5.1.1.2` `NIST 800-63 B` oraz w  [BSI Kryptographische Verfahren: Empfehlungen und Schlussell&auml;ngen (2018)](https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Publikationen/TechnischeRichtlinien/TR02102/BSI-TR-02102.pdf?__blob=publicationFile). W przypadku tych wskazówek można wybrać najnowsze standardy algorytmów i długości kluczy krajowych lub regionalnych.

Ta sekcja nie może być weryfikowana za pomocą testów penetracyjnych, dlatego kontrole nie są oznaczone jako L1. Jednak ta sekcja jest kluczowa dla bezpieczeństwa poświadczeń, więc jeśli tworzysz kopię `ASVS` na potrzeby architektury, wytycznych kodowania lub listy kontrolnej przeglądu kodu źródłowego, prosimy o umieszczenie tych kontroli z powrotem w L1 w Twojej prywatnej wersji.

|     #     | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:---------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.4.1** | Zweryfikuj, czy hasła są przechowywane w formie odpornej na ataki offline. Hasła POWINNY być solone i hashowane za pomocą zatwierdzonej jednokierunkowej funkcji pochodzenia klucza lub hashowania hasła. Funkcje pochodzenia klucza i hashowania hasła przyjmują hasło, sól i czynnik kosztu jako dane wejściowe podczas generowania skrótu hasła. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                         |    | ✓  | ✓  | 916 |                            5.1.1.2                            |
| **2.4.2** | Zweryfikuj, czy sól ma co najmniej 32 bity długości i jest wybierana arbitralnie, aby zminimalizować kolizje wartości soli między przechowywanymi skrótami. Dla każdego poświadczenia, powinna być przechowywana unikalna wartość soli i wynikowy skrót. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                                                    |    | ✓  | ✓  | 916 |                            5.1.1.2                            |
| **2.4.3** | Potwierdź, że jeśli jest używany PBKDF2, to liczba iteracji powinna być tak duża, jak pozwala na to wydajność serwera weryfikującego, zwykle co najmniej 100 000 iteracji. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                                                                                                                                  |    | ✓  | ✓  | 916 |                            5.1.1.2                            |
| **2.4.4** | Potwierdź, że jeśli jest używany bcrypt, to współczynnik pracy (work factor) POWINIEN być tak duży, jak pozwala na to wydajność serwera weryfikującego, z minimum wynoszącym 10. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                                                                                                                            |    | ✓  | ✓  | 916 |                            5.1.1.2                            |
| **2.4.5** | Zweryfikuj, że dodatkowa iteracja funkcji pochodzenia klucza jest wykonywana z wykorzystaniem wartości soli, która jest tajna i znana tylko dla weryfikatora. Wygeneruj wartość soli za pomocą zatwierdzonego generatora losowych bitów `SP 800-90Ar1` i zapewnij co najmniej minimalną siłę zabezpieczeń określoną w najnowszej wersji `SP 800-131A`. Tajna wartość soli powinna być przechowywana oddzielnie od zahaszowanych haseł (np. w specjalnym urządzeniu takim jak moduł zabezpieczeń sprzętowych `HSM`). |    | ✓  | ✓  | 916 |                            5.1.1.2                            |

Tam, gdzie wymienione są standardy USA, regionalny lub lokalny standard może zostać użyty zamiast lub wraz ze standardem USA, w miarę potrzeb.

## V2.5 Credential Recovery

|     #     | Description                                                                                                                                                                                                                                                                                                        | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:---------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.5.1** | Zweryfikuj, czy systemowo generowany początkowy sekret aktywacyjny lub odzyskiwania nie jest przesyłany do użytkownika w postaci tekstu jawnego. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                           | ✓  | ✓  | ✓  | 640 |                            5.1.1.2                            |
| **2.5.2** | Upewnij się, że wskazówki do odzyskania hasła lub uwierzytelnianie oparte na wiedzy (tzw. "pytania tajne") nie są obecne.                                                                                                                                                                                          | ✓  | ✓  | ✓  | 640 |                            5.1.1.2                            |
| **2.5.3** | Zweryfikuj, że odzyskiwanie haseł nie ujawnia aktualnego hasła w żaden sposób. ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering))                                                                                                                                                             | ✓  | ✓  | ✓  | 640 |                            5.1.1.2                            |
| **2.5.4** | Zweryfikuj że współdzielone lub domyślne konta nie są używane (np. "root", "admin", lub "sa").                                                                                                                                                                                                                     | ✓  | ✓  | ✓  | 16  |                         5.1.1.2 / A.3                         |
| **2.5.5** | Zweryfikuj, czy użytkownik jest powiadamiany o zmianie lub zastąpieniu mechanizmu uwierzytelniającego.                                                                                                                                                                                                             | ✓  | ✓  | ✓  | 304 |                            6.1.2.3                            |
| **2.5.6** | Zweryfikuj, że zapomniane hasło oraz inne ścieżki odzyskiwania wykorzystują bezpieczne mechanizmy odzyskiwania, takie jak jednorazowe hasła (TOTP) lub sprzętowy token, mobilne powiadomienia push lub inny mechanizm odzyskiwania offline.([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓  | ✓  | ✓  | 640 |                            5.1.1.2                            |
| **2.5.7** | Zweryfikuj, że jeśli urządzenia OTP lub inne mechanizmy uwierzytelniania wieloskładnikowego zostaną utracone, to przeprowadzane są dowody potwierdzające tożsamość na tym samym poziomie, co podczas rejestracji.                                                                                                  |    | ✓  | ✓  | 308 |                            6.1.2.3                            |

## V2.6 Kody jednorazowe

Kody jednorazowe (ang. Look-up Secret Verifier) to z góry wygenerowane listy kodów tajnych, podobne do numerów autoryzacji transakcji (ang. Transaction Authorization Numbers — `TAN`), kodów odzyskiwania kont na portalach społecznościowych lub siatki zawierającej zestaw losowych wartości. Są one bezpiecznie dystrybuowane do użytkowników. Kody jednorazowe z listy są używane tylko raz, a po wyczerpaniu całej listy kodów, lista jest usuwana. Ten typ autentykatora jest uważany za *coś, co posiadasz*.

|     #     | Description                                                                                                                                                                                                                                        | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:---------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.6.1** | Sprawdź, czy kody jednorazowe mogą być użyte tylko raz.                                                                                                                                                                                            |    | ✓  | ✓  | 308 |                            5.1.2.2                            |
| **2.6.2** | Upewnij się, że kody jednorazowe mają wystarczającą losowość (112 bitów entropii) lub jeśli mniej niż 112 bitów entropii, to są solone unikalną i losową solą 32-bitową i hashowane przy użyciu zatwierdzonej jednokierunkowej funkcji haszującej. |    | ✓  | ✓  | 330 |                            5.1.2.2                            |
| **2.6.3** | Zweryfikuj, że kody jednorazowe są odporne na ataki offline, takie jak przewidywalne wartości.                                                                                                                                                     |    | ✓  | ✓  | 310 |                            5.1.2.2                            |

## V2.7 Weryfikator z wykorzystaniem innego kanału

W przeszłości często wykorzystywanym weryfikatorem poprzez inny kanał była wiadomość e-mail lub SMS zawierająca link resetujący hasło. Atakujący wykorzystują tę słabą metodę do resetowania kont, których jeszcze nie kontrolują, na przykład przejmując konto e-mailowe osoby i wykorzystując odkryte linki resetowania. Istnieją lepsze sposoby na obsługę weryfikacji resetowania hasła.

Bezpieczne `autentykatory` to fizyczne urządzenia, które mogą komunikować się z aplikacją weryfikującą za pośrednictwem bezpiecznego kanału wtórnego. Przykłady obejmują powiadomienia typu push na urządzenia mobilne. Ten typ `autentykatora` jest uważany za *coś, co posiadasz*. Kiedy użytkownik chce się uwierzytelnić, aplikacja weryfikująca wysyła wiadomość do `autentykatora` bezpośrednio lub pośrednio przez usługę strony trzeciej. Wiadomość zawiera kod uwierzytelniający (zwykle losowy sześciocyfrowy numer lub modalne okno zatwierdzenia). Aplikacja weryfikująca czeka na otrzymanie kodu uwierzytelniającego przez kanał główny i porównuje hash wartości otrzymanej z hashem pierwotnego kodu uwierzytelniającego. Jeśli się zgadzają, `autentykator`  uzna, że użytkownik został uwierzytelniony.

`ASVS` zakłada, że tylko nieliczni programiści będą tworzyć nowe `autentykatory`, takie jak powiadomienia typu push, i dlatego następujące kontrole `ASVS` dotyczą weryfikatorów, takich jak API uwierzytelniające, aplikacje i implementacje pojedynczego logowania. Jeśli tworzysz nowy `autentykator`, odwołaj się do `NIST 800-63B` § 5.1.3.1.

Niebezpieczne `autentykatory`, takie jak e-mail i VOIP, nie są już dozwolone. Autentykacja PSTN i SMS jest obecnie "ograniczona" przez `NIST` i powinna być wycofywana na rzecz powiadomień typu push lub podobnych. Jeśli musisz użyć autentykacji za pośrednictwem telefonu lub SMS, zobacz § 5.1.3.3.

|     #     | Description                                                                                                                                                                                                                                | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:---------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.7.1** | Sprawdź, czy autentykatory używające otwartego testu (tzw. "restricted" przez NIST), takie jak SMS lub PSTN, nie są oferowane domyślnie, a silniejsze alternatywy, takie jak powiadomienia typu push, są oferowane w pierwszej kolejności. | ✓  | ✓  | ✓  | 287 |                            5.1.3.2                            |
| **2.7.2** | Zweryfikuj, że wygenerowany przez `autentykator` kod jednorazowy wygasa po 10 minutach od żądania uwierzytelnienia.                                                                                                                        | ✓  | ✓  | ✓  | 287 |                            5.1.3.2                            |
| **2.7.3** | Zweryfikuj, że żądania uwierzytelniania, kody lub tokeny wysyłane przez `autentykator` są używane tylko raz i tylko do pierwotnego żądania uwierzytelnienia.                                                                               | ✓  | ✓  | ✓  | 287 |                            5.1.3.2                            |
| **2.7.4** | Zweryfikuj, że `autentykator`  (ang. out of band authenticator) i aplikacja weryfikująca komunikują się przez niezależny i bezpieczny kanał.                                                                                               | ✓  | ✓  | ✓  | 523 |                            5.1.3.2                            |
| **2.7.5** | Zweryfikuj, że `autentykator` przechowuje tylko zahaszowaną wersję kodu uwierzytelnienia.                                                                                                                                                  |    | ✓  | ✓  | 256 |                            5.1.3.2                            |
| **2.7.6** | Potwierdź, że początkowy kod uwierzytelniania jest generowany przez bezpieczny generator liczb losowych, zawierający co najmniej 20 bitów entropii (zwykle wystarczy sześciocyfrowa losowa liczba).                                        |    | ✓  | ✓  | 310 |                            5.1.3.2                            |

## V2.8 One Time Verifier

Jednoskładnikowe jednorazowe hasła (OTP) to fizyczne lub programowe tokeny wyświetlające ciągle zmieniające się pseudolosowe jednorazowe wyzwania. Urządzenia te utrudniają phishing (podszycie), ale nie uniemożliwiają go. Ten typ `autentykatora` jest uważany za *coś, co masz*. Wieloskładnikowe tokeny są podobne do jednoskładnikowych OTP, ale wymagają wprowadzenia prawidłowego kodu PIN, odblokowania biometrycznego, włożenia klucza USB, potwierdzenia przez NFC, lub wprowadzenia dodatkowej wartości (takiej jak kalkulatory do podpisywania transakcji) w celu utworzenia końcowego OTP.

|     #     |     | Description                                                                                                                                                                                                                                                         | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:---------:|:----|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.8.1** |     | Upewnij się, że jednorazowe OTP mają określony czas życia przed wygaśnięciem.                                                                                                                                                                                       | ✓  | ✓  | ✓  | 613 |                       5.1.4.2 / 5.1.5.2                       |
| **2.8.2** |     | Potwierdź, że symetryczne klucze używane do weryfikacji przesłanych jednorazowych haseł (OTP) są wysoce chronione, na przykład poprzez użycie modułu bezpieczeństwa sprzętowego (HSM) lub bezpiecznego systemu operacyjnego do przechowywania kluczy.               |    | ✓  | ✓  | 320 |                       5.1.4.2 / 5.1.5.2                       |
| **2.8.3** |     | Zweryfikuj, że stosowane są zatwierdzone algorytmy kryptograficzne przy generowaniu, inicjowaniu (seeding) i weryfikacji OTP-ów.                                                                                                                                    |    | ✓  | ✓  | 326 |                       5.1.4.2 / 5.1.5.2                       |
| **2.8.4** |     | Zweryfikuj, że hasła jednorazowe oparte na czasie (time-based OTP) można wykorzystać tylko raz w okresie ważności.                                                                                                                                                  |    | ✓  | ✓  | 287 |                       5.1.4.2 / 5.1.5.2                       |
| **2.8.5** |     | Zweryfikuj, że w przypadku ponownego użycia wieloskłądnikowego tokenu jednorazowego opartego na czasie (time-based OTP) w okresie ważności, jest on logowany i odrzucany, a do posiadacza urządzenia wysyłane są bezpieczne powiadomienia.                          |    | ✓  | ✓  | 287 |                            5.1.5.2                            |
| **2.8.6** |     | Zweryfikuj, że fizyczny generator jednoskładnikowych haseł jednorazowych (OTP) może zostać odwołany w przypadku kradzieży lub innej utraty. Upewnij się, że odwołanie jest natychmiastowo skuteczne we wszystkich zalogowanych sesjach, niezależnie od lokalizacji. |    | ✓  | ✓  | 613 |                             5.2.1                             |
| **2.8.7** |     | Zweryfikuj, że `autentykatory` biometryczne są ograniczone do wykorzystania tylko jako drugorzędne czynniki w połączeniu z czymś, co posiadasz i czymś, co wiesz.                                                                                                   |    | o  | ✓  | 308 |                             5.2.3                             |

## V2.9 Weryfikator Kryptograficzny

Klucze kryptograficzne to karty inteligentne lub klucze FIDO, które użytkownik musi podłączyć lub sparować urządzenie kryptograficzne z komputerem, aby zakończyć uwierzytelnianie. Weryfikatory wysyłają wyzwanie autoryzacyjne do urządzeń kryptograficznych lub oprogramowania, a urządzenie lub oprogramowanie oblicza odpowiedź na podstawie bezpiecznie przechowywanego klucza kryptograficznego.

Wymagania dla jednoskładnikowych urządzeń i oprogramowania kryptograficznego oraz wieloskładnikowych urządzeń i oprogramowania kryptograficznego są takie same, ponieważ weryfikacja `autentykatora` kryptograficznego dowodzi posiadania czynnika uwierzytelniania.

|     #     | Description                                                                                                                                                                                                                                                                                                               | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:---------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:--:|:--:|:---:|:-------------------------------------------------------------:|
| **2.9.1** | Sprawdź, czy klucze kryptograficzne używane do weryfikacji są przechowywane bezpiecznie i czy są chronione przed ujawnieniem, na przykład za pomocą Modułu Platformy Zaufanej (TPM) lub Modułu Bezpieczeństwa Sprzętowego (HSM) lub usługi systemu operacyjnego, która może korzystać z tego bezpiecznego przechowywania. |    | ✓  | ✓  | 320 |                            5.1.7.2                            |
| **2.9.2** | Sprawdź, czy wyzwanie autoryzacyjne ma co najmniej 64 bity długości i jest statystycznie unikalne lub unikalne przez cały okres użytkowania urządzenia kryptograficznego.                                                                                                                                                 |    | ✓  | ✓  | 330 |                            5.1.7.2                            |
| **2.9.3** | Sprawdź, czy podczas generowania, inicjowania oraz weryfikacji są używane zatwierdzone algorytmy kryptograficzne.                                                                                                                                                                                                         |    | ✓  | ✓  | 327 |                            5.1.7.2                            |

## V2.10 Uwierzytelnianie Usług

Ta sekcja nie jest możliwa do przetestowania penetracyjnego, więc nie ma żadnych wymagań na poziomie `L1`. Jednakże, jeśli jest używana w architekturze, kodowaniu lub przeglądzie bezpieczeństwa kodu, proszę przyjąć, że zastosowanie odpowiedniego zabezpieczenia programistycznego (takiego jak Java Key Store) stanowi minimalne wymaganie na poziomie `L1`. Przechowywanie danych uwierzytelniania (secrets) w postaci jawnej nie jest dopuszczalne pod żadnym względem.

|     #      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | L1 |     L2      | L3  | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
|:----------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--:|:-----------:|:---:|:---:|:-------------------------------------------------------------:|
| **2.10.1** | Sprawdź, czy dane autoryzacyjne używane do autentykacji między usługami nie polegają na niezmieniających się poświadczeniach, takich jak hasła, klucze API czy współdzielone konta z uprawnieniami administracyjnymi.                                                                                                                                                                                                                                                                                                         |    | OS assisted | HSM | 287 |                            5.1.1.1                            |
| **2.10.2** | Sprawdź, czy w przypadku wymagania haseł do uwierzytelniania usług, używane konto usługi nie jest domyślnym kontem systemowym z domyślnym hasłem (np. root/root lub admin/admin są domyślne w niektórych usługach podczas instalacji).                                                                                                                                                                                                                                                                                        |    | OS assisted | HSM | 255 |                            5.1.1.1                            |
| **2.10.3** | Sprawdź, czy hasła są przechowywane z wystarczającą ochroną, aby zapobiec atakom odzyskiwania offline, w tym do dostępu do lokalnego systemu.                                                                                                                                                                                                                                                                                                                                                                                 |    | OS assisted | HSM | 522 |                            5.1.1.1                            |
| **2.10.4** | Sprawdź, czy hasła, używane do integracji z bazami danych i systemami zewnętrznymi, klucze API oraz inne dane autoryzacyjne są bezpiecznie zarządzane i nie są zawarte w kodzie źródłowym ani przechowywane w repozytoriach kodu źródłowego. Takie przechowywanie POWINNO być odporne na ataki offline. Zaleca się użycie do przechowywania haseł przynajmniej bezpiecznego programistycznego magazynu kluczy `secure software key store` dla systemów sklasyfikowanych jako `L1` lub `L2`, sprzętowego TPM lub HSM dla `L3`. |    | OS assisted | HSM | 798 |                                                               |

## Dodatkowe Wymagania dla Agencji Stanów Zjednoczonych

Agencje rządowe Stanów Zjednoczonych mają obowiązkowe wymagania dotyczące `NIST 800-63`. Standard Weryfikacji Bezpieczeństwa Aplikacji (`ASVS`) zawsze dotyczył 80% kontroli, które mają zastosowanie do prawie 100% aplikacji, a nie pozostałych 20% zaawansowanych kontroli lub tych o ograniczonej przydatności. W związku z tym `ASVS` stanowi ścisły podzbiór `NIST 800-63`, zwłaszcza dla klasyfikacji `IAL1/2` oraz `AAL1/2`, ale nie jest wystarczająco kompleksowy, szczególnie w odniesieniu do klasyfikacji `IAL3`/`AAL3`.

Zdecydowanie zalecamy agencjom rządowym Stanów Zjednoczonych zapoznanie się z NIST 800-63 w całości i wdrożenie tego standardu.

## Słownikczek pojęć

| Pojęcie                              | Znaczenie                                                                                                                                                                                                                                                                                                                          |
|--------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CSP                                  | Dostawca usług poświadczeń, zwany również dostawcą tożsamości (ang. Credential Service Provider lub Identity Provider).                                                                                                                                                                                                            |
| Autentykator                         | Kod, który uwierzytelnia hasło, token, uwierzytelnianie wieloskładnikowe (MFA), asercję federacyjną itp.                                                                                                                                                                                                                           |
| Weryfikator (Aplikacja weryfikująca) | "Podmiot, który weryfikuje tożsamość wnioskodawcy, sprawdzając posiadanie i kontrolowanie przez niego jednego lub dwóch autentykatorów za pomocą protokołu uwierzytelniania. Aby to zrobić, weryfikator może również sprawdzić poświadczenia, które łączą autentykator(-y) z identyfikatorem wnioskodawcy i sprawdzić ich status." |
| OTP                                  | Hasło jednorazowe (ang. One-time password)                                                                                                                                                                                                                                                                                         |
| SFA                                  | Jednoskładnikowe autentykatory, takie jak coś, co znasz (tajne frazy, hasła, hasła wielowyrazowe, kody PIN), coś, kim jesteś (biometria, odcisk palca, skanowanie twarzy) lub coś, co posiadasz (tokeny OTP, urządzenie kryptograficzne, takie jak karta inteligentna)                                                             |
| MFA                                  | Uwierzytelnianie wieloskładnikowe (multi-factor authentication), które obejmuje dwa lub więcej jednoskładnikowych autentykatorów.                                                                                                                                                                                                  |

## References

Po więcej informacji przeczytaj również:

* [NIST 800-63 - Digital Identity Guidelines](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63-3.pdf)
* [NIST 800-63 A - Enrollment and Identity Proofing](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63a.pdf)
* [NIST 800-63 B - Authentication and Lifecycle Management](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf)
* [NIST 800-63 C - Federation and Assertions](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63c.pdf)
* [NIST 800-63 FAQ](https://pages.nist.gov/800-63-FAQ/)
* [OWASP Testing Guide 4.0: Testing for Authentication](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/04-Authentication_Testing/README.html)
* [OWASP Cheat Sheet - Password storage](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
* [OWASP Cheat Sheet - Forgot password](https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html)
* [OWASP Cheat Sheet - Choosing and using security questions](https://cheatsheetseries.owasp.org/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html)
